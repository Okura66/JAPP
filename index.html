<!DOCTYPE html>
<html>
<head>
    <!-- Load the JotForm Custom Widget API -->
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    <!-- Load intl-tel-input CSS and JS for phone input functionality -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <!-- Custom CSS for error message styling -->
    <style>
        .error-message {
            color: red;
            font-size: 0.9em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div id="main">
        <h3>Please enter your phone number</h3>
        <!-- Phone input field -->
        <input type="tel" id="phoneInput">
        <!-- Error message container -->
        <div id="errorMsg" class="error-message"></div>
    </div>

    <script type="text/javascript">
        // Subscribe to the "ready" event to initialize the widget
        JFCustomWidget.subscribe("ready", function(){
            // Select the phone input field and error message container
            var phoneInput = document.querySelector("#phoneInput");
            var errorMsg = document.querySelector("#errorMsg");

            // Initialize intl-tel-input with desired settings
            var iti = window.intlTelInput(phoneInput, {
                initialCountry: "fr", // Set default country to France
                separateDialCode: true, // Display country dial code separately
                strictMode: true,
                utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js" // Load utilities for validation
            });

            // Function to reset the error message
            function resetError() {
                errorMsg.innerHTML = "";
            }

            // Add event listeners to reset error message on input change or focus
            phoneInput.addEventListener('change', resetError);
            phoneInput.addEventListener('keyup', resetError);
            phoneInput.addEventListener('focus', resetError);

            // Function to adjust the iframe size based on content
            function adjustIframeSize() {
                // Get the height of the main content
                var contentHeight = document.getElementById('main').offsetHeight;
                // Request the parent frame to resize the iframe
                JFCustomWidget.requestFrameResize({
                    height: contentHeight + 20 // Add some padding
                });
            }

            // Adjust iframe size on initial load
            adjustIframeSize();

            // Adjust iframe size when window is resized
            window.addEventListener('resize', adjustIframeSize);

            // Subscribe to the "submit" event to validate and send data
            JFCustomWidget.subscribe("submit", function(){
                // Check if the entered phone number is valid
                if (iti.isValidNumber()) {
                    // Send valid data to JotForm
                    JFCustomWidget.sendSubmit({
                        valid: true,
                        value: iti.getNumber() // Get full phone number with country code
                    });
                } else {
                    // Display error message
                    errorMsg.innerHTML = "Veuillez entrer un numéro de téléphone valide.";
                    // Prevent form submission
                    JFCustomWidget.sendSubmit({ valid: false });
                }
            });
        });
    </script>
</body>
</html>
