<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript">
        (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = '//js.jotform.com/JotFormCustomWidget.min.js?onload=onLoadCallback';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
        // Ajout du script pour le plugin de sélection de pays et de format de téléphone
        var intlTelInputScript = document.createElement('script');
        intlTelInputScript.src = "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js";
        document.head.appendChild(intlTelInputScript);

        var intlTelInputCSS = document.createElement('link');
        intlTelInputCSS.rel = "stylesheet";
        intlTelInputCSS.href = "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css";
        document.head.appendChild(intlTelInputCSS);
    </script>
</head>
<body>
    <div id="main">
        <div>
            <input type="tel" id="phoneInput" placeholder="Enter your phone number">
            <div id="error-message" style="color: red; display: none;">Invalid phone number</div>
        </div>
    </div>
    
    <script type="text/javascript">
        // Configuration et initialisation du champ de numéro de téléphone avec le sélecteur de pays
        intlTelInputScript.onload = function() {
            const phoneInputField = document.querySelector("#phoneInput");
            const errorMessage = document.querySelector("#error-message");
            const iti = window.intlTelInput(phoneInputField, {
                initialCountry: "us",
                utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
                nationalMode: true,
                formatOnDisplay: true
            });

            // Abonnement à l'événement "ready" de JotForm
            JFCustomWidget.subscribe("ready", function() {
                var label = JFCustomWidget.getWidgetSetting('QuestionLabel');
                document.getElementById('labelText').innerHTML = label;

                // Gestionnaire de soumission du formulaire pour valider et envoyer les informations de téléphone
                JFCustomWidget.subscribe("submit", function() {
                    const phoneNumber = iti.getNumber();
                    const isValid = iti.isValidNumber();

                    if (!isValid) {
                        errorMessage.style.display = 'block';
                    } else {
                        errorMessage.style.display = 'none';
                    }

                    const msg = {
                        valid: isValid,
                        value: isValid ? phoneNumber : "Invalid phone number"
                    };
                    JFCustomWidget.sendSubmit(msg);
                });
            });

            // Limiter la saisie en fonction de l'indicatif du pays
            phoneInputField.addEventListener('input', function() {
                const countryData = iti.getSelectedCountryData();
                const maxLength = countryData.dialCode.length + 10; // Adjust length based on country code
                if (phoneInputField.value.length > maxLength) {
                    phoneInputField.value = phoneInputField.value.slice(0, maxLength);
                }
            });
        };
    </script>
</body>
</html>
