<!DOCTYPE html>
<html>
<head>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"></script>
</head>
<body>
    <div id="main">
        <h3>Veuillez entrer votre numéro de téléphone</h3>
        <input type="tel" id="phoneInput">
    </div>

    <script type="text/javascript">
        JFCustomWidget.subscribe("ready", function(){
            // Initialisation de intl-tel-input
            var phoneInput = document.querySelector("#phoneInput");
            var iti = window.intlTelInput(phoneInput, {
                initialCountry: "fr",
                separateDialCode: true,
                utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js" // Utilisé pour la validation
            });

            // Filtrage des caractères saisis
            phoneInput.addEventListener('input', function() {
                var cursorPosition = phoneInput.selectionStart;
                var inputValue = phoneInput.value;

                // Autoriser uniquement les chiffres et le signe plus au début
                var filteredValue = inputValue.replace(/[^\d+]/g, '');

                // Assurer que le signe plus est uniquement au début
                if (filteredValue.indexOf('+') > 0) {
                    filteredValue = filteredValue.replace(/\+/g, '');
                }

                // Limiter la longueur du numéro
                var maxLength = iti.getNumber().length;
                if (filteredValue.length > maxLength) {
                    filteredValue = filteredValue.slice(0, maxLength);
                }

                phoneInput.value = filteredValue;
                phoneInput.setSelectionRange(cursorPosition, cursorPosition);
            });

            // Validation lors de la soumission
            JFCustomWidget.subscribe("submit", function(){
                if (iti.isValidNumber()) {
                    var msg = {
                        valid: true,
                        value: iti.getNumber() // Retourne le numéro complet avec indicatif du pays
                    };
                    JFCustomWidget.sendSubmit(msg);
                } else {
                    alert("Veuillez entrer un numéro de téléphone valide.");
                    var msg = { valid: false };
                    JFCustomWidget.sendSubmit(msg);
                }
            });
        });
    </script>
</body>
</html>
