<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript">
        (function() {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = '//js.jotform.com/JotFormCustomWidget.min.js?onload=onLoadCallback';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();

        // Chargement du plugin de sélection de pays et formatage de numéro de téléphone
        var intlTelInputScript = document.createElement('script');
        intlTelInputScript.src = "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js";
        document.head.appendChild(intlTelInputScript);

        var intlTelInputCSS = document.createElement('link');
        intlTelInputCSS.rel = "stylesheet";
        intlTelInputCSS.href = "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css";
        document.head.appendChild(intlTelInputCSS);
    </script>
</head>
<body>
    <div id="main">
        <div>
            <input type="tel" id="phoneInput" placeholder="Enter your phone number">
        </div>
    </div>
    
    <script type="text/javascript">
        // Configuration et initialisation du champ de numéro de téléphone avec le sélecteur de pays
        intlTelInputScript.onload = function() {
            const phoneInputField = document.querySelector("#phoneInput");
            const iti = window.intlTelInput(phoneInputField, {
                initialCountry: "us",
                utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
                nationalMode: false,
                formatOnDisplay: true
            });

            // Abonnement à l'événement "ready" de JotForm
            JFCustomWidget.subscribe("ready", function() {
                var label = JFCustomWidget.getWidgetSetting('QuestionLabel');
                document.getElementById('labelText').innerHTML = label;

                // Validation de soumission du formulaire
                JFCustomWidget.subscribe("submit", function() {
                    const phoneNumber = iti.getNumber();
                    const isValid = iti.isValidNumber();

                    // Bloque la soumission si le numéro n'est pas valide et affiche un message d'alerte
                    if (!isValid) {
                        alert("The phone number entered is not valid. Please check and try again.");
                        return;
                    }

                    const msg = {
                        valid: isValid,
                        value: phoneNumber
                    };
                    JFCustomWidget.sendSubmit(msg);
                });
            });

            // Limite le nombre de chiffres selon le pays sélectionné
            phoneInputField.addEventListener('input', function() {
                const countryData = iti.getSelectedCountryData();
                const maxLength = countryData.dialCode.length + 10; // Ajustez en fonction des besoins spécifiques
                if (phoneInputField.value.length > maxLength) {
                    phoneInputField.value = phoneInputField.value.slice(0, maxLength);
                }
            });

            // Change la limite en fonction de l'indicatif de pays
            phoneInputField.addEventListener('countrychange', function() {
                const countryData = iti.getSelectedCountryData();
                phoneInputField.maxLength = countryData.dialCode.length + 10;
            });
        };
    </script>
</body>
</html>
